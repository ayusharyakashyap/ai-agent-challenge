# AI Agent for Bank Statement PDF Parsing

ğŸ¤– **Autonomous coding agent that generates custom parsers for bank statement PDFs**

## Architecture Overview

The agent follows a **plan â†’ generate â†’ test â†’ self-fix** loop:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Planner   â”‚â”€â”€â”€â–¶â”‚ Code Gen     â”‚â”€â”€â”€â–¶â”‚   Tester    â”‚â”€â”€â”€â–¶â”‚  Evaluator   â”‚
â”‚             â”‚    â”‚              â”‚    â”‚             â”‚    â”‚              â”‚
â”‚ - Analyze   â”‚    â”‚ - Generate   â”‚    â”‚ - Run tests â”‚    â”‚ - Check pass â”‚
â”‚   PDF       â”‚    â”‚   parser.py  â”‚    â”‚ - Compare   â”‚    â”‚ - Self-fix   â”‚
â”‚ - Extract   â”‚    â”‚ - Use LLM    â”‚    â”‚   with CSV  â”‚    â”‚ - Max 3 triesâ”‚
â”‚   patterns  â”‚    â”‚   prompts    â”‚    â”‚             â”‚    â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â–²                                                          â”‚
       â”‚                                                          â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            Feedback Loop
```

**The agent autonomously**: Analyzes PDF structure â†’ Plans extraction strategy â†’ Generates parser code â†’ Tests against expected CSV â†’ Self-corrects up to 3 times if tests fail.

## Quick Start (5 Steps)

### 1. **Clone & Setup**
```bash
git clone https://github.com/apurv-korefi/ai-agent-challenge.git
cd ai-agent-challenge
pip install -r requirements.txt
```

### 2. **Configure API Key**
```bash
cp .env.example .env
# Edit .env and add your API key:
# GOOGLE_API_KEY=your_gemini_api_key_here
# OR
# GROQ_API_KEY=your_groq_api_key_here
```

**Get free API keys:**
- **Google Gemini**: https://makersuite.google.com/app/apikey
- **Groq**: https://console.groq.com/keys

### 3. **Run Agent**
```bash
python agent.py --target icici
```

### 4. **Test Results**
```bash
pytest test_parsers.py -v
```

### 5. **Verify Output**
```bash
ls custom_parsers/  # Should contain icici_parser.py
```

## Usage

```bash
# Generate ICICI parser
python agent.py --target icici --provider gemini

# Use Groq instead of Gemini
python agent.py --target icici --provider groq

# Test any generated parser
pytest test_parsers.py::TestBankParsers::test_icici_parser_output -v
```

## Agent Capabilities

âœ… **Autonomous Planning**: Analyzes PDF structure and CSV schema  
âœ… **Smart Code Generation**: Uses LLM to generate parsing logic  
âœ… **Automated Testing**: Compares output with expected CSV using `DataFrame.equals()`  
âœ… **Self-Correction**: Up to 3 retry attempts with error feedback  
âœ… **Multiple LLM Providers**: Google Gemini & Groq support  
âœ… **CLI Interface**: `python agent.py --target <bank_name>`

## Generated Parser Contract

Each generated parser follows this contract:

```python
def parse(pdf_path: str) -> pd.DataFrame:
    """
    Parse bank statement PDF and return structured data
    
    Args:
        pdf_path: Path to the PDF file
        
    Returns:
        DataFrame with columns: Date, Description, Debit Amt, Credit Amt, Balance
    """
    pass
```

## Project Structure

```
ai-agent-challenge/
â”œâ”€â”€ agent.py              # Main agent with LangGraph workflow
â”œâ”€â”€ test_parsers.py       # Automated test suite
â”œâ”€â”€ requirements.txt      # Dependencies
â”œâ”€â”€ .env.example         # Environment template
â”œâ”€â”€ data/
â”‚   â””â”€â”€ icici/
â”‚       â”œâ”€â”€ icici sample.pdf    # Sample bank statement
â”‚       â””â”€â”€ result.csv          # Expected parsed output
â””â”€â”€ custom_parsers/       # Generated parser files
    â””â”€â”€ icici_parser.py   # Auto-generated by agent
```

## Demo

**ğŸ¬ Complete demo in â‰¤60 seconds:**

```bash
# Fresh clone to success
git clone <repo> && cd ai-agent-challenge
pip install -r requirements.txt
echo "GOOGLE_API_KEY=sk-..." > .env
python agent.py --target icici
pytest test_parsers.py -v
# All tests pass!
```

## Technical Details

- **Framework**: LangGraph for agent workflow orchestration
- **LLM Providers**: Google Gemini Pro / Groq Mixtral
- **PDF Processing**: pdfplumber + PyPDF2 for robust extraction
- **Testing**: pytest with pandas DataFrame comparison
- **Self-Correction**: Error feedback loop with max 3 attempts

## Adding New Banks

To extend for new banks (e.g., SBI):

1. Add sample data: `data/sbi/sbi_sample.pdf` + `data/sbi/result.csv`
2. Run: `python agent.py --target sbi`
3. Agent automatically generates: `custom_parsers/sbi_parser.py`
