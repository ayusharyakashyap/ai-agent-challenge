# AI Agent for Bank Statement PDF Parsing

🤖 **Autonomous coding agent that generates custom parsers for bank statement PDFs**

## Architecture Overview

The agent follows a **plan → generate → test → self-fix** loop:

```
┌─────────────┐    ┌──────────────┐    ┌─────────────┐    ┌──────────────┐
│   Planner   │───▶│ Code Gen     │───▶│   Tester    │───▶│  Evaluator   │
│             │    │              │    │             │    │              │
│ - Analyze   │    │ - Generate   │    │ - Run tests │    │ - Check pass │
│   PDF       │    │   parser.py  │    │ - Compare   │    │ - Self-fix   │
│ - Extract   │    │ - Use LLM    │    │   with CSV  │    │ - Max 3 tries│
│   patterns  │    │   prompts    │    │             │    │              │
└─────────────┘    └──────────────┘    └─────────────┘    └──────────────┘
       ▲                                                          │
       │                                                          │
       └──────────────────────────────────────────────────────────┘
                            Feedback Loop
```

**The agent autonomously**: Analyzes PDF structure → Plans extraction strategy → Generates parser code → Tests against expected CSV → Self-corrects up to 3 times if tests fail.

## Quick Start (5 Steps)

### 1. **Clone & Setup**
```bash
git clone https://github.com/apurv-korefi/ai-agent-challenge.git
cd ai-agent-challenge
pip install -r requirements.txt
```

### 2. **Configure API Key**
```bash
cp .env.example .env
# Edit .env and add your API key:
# GOOGLE_API_KEY=your_gemini_api_key_here
# OR
# GROQ_API_KEY=your_groq_api_key_here
```

**Get free API keys:**
- **Google Gemini**: https://makersuite.google.com/app/apikey
- **Groq**: https://console.groq.com/keys

### 3. **Run Agent**
```bash
python agent.py --target icici
```

### 4. **Test Results**
```bash
pytest test_parsers.py -v
```

### 5. **Verify Output**
```bash
ls custom_parsers/  # Should contain icici_parser.py
```

## Usage

```bash
# Generate ICICI parser
python agent.py --target icici --provider gemini

# Use Groq instead of Gemini
python agent.py --target icici --provider groq

# Test any generated parser
pytest test_parsers.py::TestBankParsers::test_icici_parser_output -v
```

## Agent Capabilities

✅ **Autonomous Planning**: Analyzes PDF structure and CSV schema  
✅ **Smart Code Generation**: Uses LLM to generate parsing logic  
✅ **Automated Testing**: Compares output with expected CSV using `DataFrame.equals()`  
✅ **Self-Correction**: Up to 3 retry attempts with error feedback  
✅ **Multiple LLM Providers**: Google Gemini & Groq support  
✅ **CLI Interface**: `python agent.py --target <bank_name>`

## Generated Parser Contract

Each generated parser follows this contract:

```python
def parse(pdf_path: str) -> pd.DataFrame:
    """
    Parse bank statement PDF and return structured data
    
    Args:
        pdf_path: Path to the PDF file
        
    Returns:
        DataFrame with columns: Date, Description, Debit Amt, Credit Amt, Balance
    """
    pass
```

## Project Structure

```
ai-agent-challenge/
├── agent.py              # Main agent with LangGraph workflow
├── test_parsers.py       # Automated test suite
├── requirements.txt      # Dependencies
├── .env.example         # Environment template
├── data/
│   └── icici/
│       ├── icici sample.pdf    # Sample bank statement
│       └── result.csv          # Expected parsed output
└── custom_parsers/       # Generated parser files
    └── icici_parser.py   # Auto-generated by agent
```

## Demo

**🎬 Complete demo in ≤60 seconds:**

```bash
# Fresh clone to success
git clone <repo> && cd ai-agent-challenge
pip install -r requirements.txt
echo "GOOGLE_API_KEY=sk-..." > .env
python agent.py --target icici
pytest test_parsers.py -v
# All tests pass!
```

## Technical Details

- **Framework**: LangGraph for agent workflow orchestration
- **LLM Providers**: Google Gemini Pro / Groq Mixtral
- **PDF Processing**: pdfplumber + PyPDF2 for robust extraction
- **Testing**: pytest with pandas DataFrame comparison
- **Self-Correction**: Error feedback loop with max 3 attempts

## Adding New Banks

To extend for new banks (e.g., SBI):

1. Add sample data: `data/sbi/sbi_sample.pdf` + `data/sbi/result.csv`
2. Run: `python agent.py --target sbi`
3. Agent automatically generates: `custom_parsers/sbi_parser.py`
